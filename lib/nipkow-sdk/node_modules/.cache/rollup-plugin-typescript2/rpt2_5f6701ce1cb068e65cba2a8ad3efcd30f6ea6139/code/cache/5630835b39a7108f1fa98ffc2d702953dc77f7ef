{"code":"const app = window.require('electron').remote;\r\nconst tls = app.require('tls');\r\nconst process = app.require('process');\r\nclass ProxyProvider {\r\n    constructor() {\r\n        this.responseFlag = 0;\r\n    }\r\n    async _init(host, port, requestBuffer) {\r\n        return new Promise((resolve, reject) => {\r\n            const options = {\r\n                rejectUnauthorized: false,\r\n                secureProtocol: 'TLSv1_1_method',\r\n            };\r\n            this.sock = tls.connect(port, host, options, () => {\r\n                console.log('TLS client connected and it is', this.sock.authorized ? 'authorized' : 'unauthorized');\r\n                process.stdin.pipe(this.sock);\r\n                process.stdin.resume();\r\n            });\r\n            this.sock.setEncoding('utf8');\r\n            this.sock.on('timeout', function () {\r\n                console.log('TLS client timed out');\r\n            });\r\n            this.sock.on('end', () => {\r\n                console.log('TLS server ended connection');\r\n            });\r\n            this.sock.on('error', (error) => {\r\n                console.log(error);\r\n                reject();\r\n            });\r\n            this.sock.on('secureConnect', () => {\r\n                this.sock.setNoDelay(true);\r\n                this.sock.setKeepAlive(true, 0);\r\n                this.sock.write(requestBuffer);\r\n                resolve(true);\r\n            });\r\n        });\r\n    }\r\n    async sendRequest(host, port, request) {\r\n        console.log(request);\r\n        const requestBuffer = Buffer.from(request);\r\n        // const length = requestBuffer.length;\r\n        // const lengthBuffer = Buffer.allocUnsafe(4);\r\n        // lengthBuffer.writeIntBE(length, 0, 4);\r\n        // const buffer = Buffer.concat([lengthBuffer, requestBuffer]);\r\n        if (this.sock) {\r\n            this.sock.write(requestBuffer);\r\n        }\r\n        else {\r\n            await this._init(host, port, requestBuffer);\r\n        }\r\n        return new Promise((resolve, reject) => {\r\n            this.sock.on('data', (data) => {\r\n                console.log(data);\r\n                if (this.responseFlag === 0) {\r\n                    this.responseFlag = 1;\r\n                }\r\n                else {\r\n                    this.responseFlag = 0;\r\n                    // const response = JSON.parse(data);\r\n                    resolve(data);\r\n                }\r\n            });\r\n        });\r\n    }\r\n}\r\nexport default new ProxyProvider();\r\n//# sourceMappingURL=ProxyProvider.js.map","references":["/home/xkn/Desktop/integration/nipkow/node_modules/electron/electron.d.ts","/home/xkn/Desktop/integration/nipkow/node_modules/process/index.js"],"map":"{\"version\":3,\"file\":\"ProxyProvider.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/ProxyProvider.ts\"],\"names\":[],\"mappings\":\"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\"}"}
